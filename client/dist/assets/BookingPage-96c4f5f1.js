import{c as V,d as v,a as $,u as L,b as Y,r as n,R as q,j as t,m as k,B as j,M as R}from"./index-c6f04137.js";import{a as C}from"./axios-917b1704.js";import{I as m}from"./input-108b52f1.js";import{L as d}from"./label-74ca07f3.js";import{C as _,a as J,b as A,c as G,d as H,e as U}from"./card-4b24962a.js";import{C as z}from"./check-circle-f52ace4b.js";import{D as K,U as Q}from"./users-4ae25648.js";import{C as h}from"./calendar-days-1d227aa6.js";const W=V("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),X=async o=>{const i=localStorage.getItem("touristPlacesIndia");return i&&JSON.parse(i).find(r=>r.id===o)||null},ce=()=>{const{placeId:o}=v();v();const i=$(),{user:l}=L(),{toast:r}=Y(),[s,w]=n.useState(null),[x,P]=n.useState(""),[c,S]=n.useState(1),[f,D]=n.useState("creditCard"),[g,p]=n.useState(!0),[B,I]=n.useState(!1),[b,O]=n.useState(""),E=async()=>{p(!0);try{C.post(`http://localhost:3000/api/booking/${o}`,{userId:l.id,placeId:s.id,userName:e.target.userName.value,email:b,date:new Date}),res.data.success?r.success(res.data.message,{position:"top-center"}):r.error("Booking failed. Please try again.")}catch{r.error("Server error!")}finally{p(!1)}};n.useEffect(()=>{if(!l){r({variant:"destructive",title:"Not Logged In",description:"Please log in to make a booking."}),i("/login");return}(async()=>{p(!0);const u=await X(o);u?w(u):(r({variant:"destructive",title:"Error",description:"Place not found."}),i("/places")),p(!1)})()},[o,l,i,r]);const[Z,N]=q.useState(""),F=async a=>{a.preventDefault(),await C.post(`http://localhost:3000/api/booking/${o}`,{placeName:s.name,userName:a.target.userName.value,email:b,phone:a.target.phone.value,dateOfVisit:x,numberOfPeople:c,paymentMethod:f}).then(y=>console.log(y)).catch(y=>console.log(y)),N("Sending....");const u=new FormData(a.target);if(u.append("access_key","42f3dc7e-7bd4-468a-a2b4-e492004097fa"),await(await fetch("https://api.web3forms.com/submit",{method:"POST",body:u})).json(),s.success&&(N("Form Submitted Successfully"),a.target.reset()),!s)return;const M={id:`booking_${Date.now()}_${l.id}_${s.id}`,userId:l.id,placeId:s.id,placeName:s.name,dateOfVisit:x,numberOfPeople:c,totalPrice:s.price*c,paymentMethod:f,bookingDate:new Date().toISOString(),status:"confirmed"},T=JSON.parse(localStorage.getItem("userBookings"))||[];localStorage.setItem("userBookings",JSON.stringify([...T,M])),I(!0),r({title:"Booking Successful!",description:`Your trip to ${s.name} is confirmed.`})};return g?t.jsx("div",{className:"flex justify-center items-center h-[calc(100vh-10rem)]",children:t.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-t-4 border-b-4 border-primary"})}):s?B?t.jsxs(k.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},className:"flex flex-col items-center justify-center min-h-[calc(100vh-10rem)] text-center",children:[t.jsx(z,{className:"w-24 h-24 text-green-500 mb-6"}),t.jsx("h1",{className:"text-4xl font-bold text-primary mb-4",children:"Booking Confirmed!"}),t.jsxs("p",{className:"text-xl text-muted-foreground mb-2",children:["Your adventure to ",t.jsx("span",{className:"font-semibold text-accent",children:s.name})," is all set."]}),t.jsxs("p",{className:"text-lg text-muted-foreground mb-8",children:["Date: ",new Date(x).toLocaleDateString(),", Guests: ",c]}),t.jsxs("div",{className:"space-x-4",children:[t.jsx(j,{onClick:()=>i("/"),variant:"outline",children:"Go to Homepage"}),t.jsx(j,{onClick:()=>i("/bookings"),children:"View My Bookings"})]})]}):t.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-center justify-center min-h-[calc(100vh-10rem)] py-12",children:t.jsxs(_,{className:"w-full max-w-2xl shadow-2xl glassmorphic",children:[t.jsxs(J,{className:"text-center",children:[t.jsx(A,{className:"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent",children:"Book Your Trip"}),t.jsxs(G,{className:"text-muted-foreground",children:["Confirm details for your adventure to ",t.jsx("span",{className:"font-semibold text-primary",children:s.name}),"."]})]}),t.jsxs(H,{children:[t.jsxs("div",{className:"mb-6 p-4 border border-primary/30 rounded-lg bg-primary/5",children:[t.jsxs("h3",{className:"text-xl font-semibold text-primary flex items-center",children:[t.jsx(R,{className:"w-5 h-5 mr-2"}),s.name]}),t.jsx("p",{className:"text-muted-foreground",children:s.location}),t.jsxs("p",{className:"text-lg font-medium text-accent mt-1 flex items-center",children:[t.jsx(K,{className:"w-5 h-5 mr-1"}),s.price>0?`₹${s.price}`:"Free"," / person"]})]}),t.jsxs("form",{onSubmit:F,className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-primary flex items-center",children:s.name}),t.jsx(m,{id:s.name,name:s.name})]}),t.jsxs("div",{children:[t.jsxs(d,{htmlFor:"name",className:"flex items-center",children:[t.jsx(h,{className:"w-4 h-4 mr-2 text-primary"}),"Name"]}),t.jsx(m,{id:"userName",name:"userName",type:"name",placeholder:"Enter Your Name"})]}),t.jsxs("div",{children:[t.jsxs(d,{htmlFor:"text",className:"flex items-center",children:[t.jsx(h,{className:"w-4 h-4 mr-2 text-primary"}),"Phone number"]}),t.jsx(m,{id:"phone",name:"phone number",type:"text",placeholder:"Enter Your Phone number",required:!0})]}),t.jsxs("div",{children:[t.jsxs(d,{htmlFor:"email",className:"flex items-center",children:[t.jsx(h,{className:"w-4 h-4 mr-2 text-primary"}),"Email Address"]}),t.jsx(m,{id:"email",name:"email",type:"text",onChange:a=>O(a.target.value),required:!0,placeholder:"Enter Your Email"})]}),t.jsxs("div",{children:[t.jsxs(d,{htmlFor:"dateOfVisit",className:"flex items-center",children:[t.jsx(h,{className:"w-4 h-4 mr-2 text-primary"}),"Date of Visit"]}),t.jsx(m,{id:"dateOfVisit",name:"dateOfVisit",type:"date",value:x,onChange:a=>P(a.target.value),required:!0,min:new Date().toISOString().split("T")[0]})]}),t.jsxs("div",{children:[t.jsxs(d,{htmlFor:"numberOfPeople",className:"flex items-center",children:[t.jsx(Q,{className:"w-4 h-4 mr-2 text-primary"}),"Number of People"]}),t.jsx(m,{id:"numberOfPeople",name:"numberOfPeople",type:"number",min:"1",value:c,onChange:a=>S(parseInt(a.target.value)),required:!0})]}),t.jsxs("div",{children:[t.jsxs(d,{htmlFor:"paymentMethod",className:"flex items-center",children:[t.jsx(W,{className:"w-4 h-4 mr-2 text-primary"}),"Payment Method"]}),t.jsxs("select",{id:"paymentMethod",name:"paymentMethod",value:f,onChange:a=>D(a.target.value),required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[t.jsx("option",{value:"creditCard",children:"Credit Card"}),t.jsx("option",{value:"paypal",children:"PayPal"}),t.jsx("option",{value:"bankTransfer",children:"Bank Transfer"})]})]}),t.jsxs("div",{className:"text-2xl font-bold text-right text-primary",children:["Total: ₹",s.price*c]}),t.jsx(j,{onClick:E,disabled:g,type:"submit",name:"submit",className:"w-full bg-gradient-to-r from-primary to-accent hover:opacity-90 transition-opacity text-lg py-6",children:g?"Booking...":" Confirm Booking"})]})]}),t.jsx(U,{children:t.jsx("p",{className:"text-xs text-muted-foreground text-center w-full",children:'By clicking "Confirm Booking", you agree to our Terms of Service and Privacy Policy.'})})]})}):t.jsx("div",{className:"text-center py-10",children:t.jsx("h1",{className:"text-2xl",children:"Place not found."})})};export{ce as default};
