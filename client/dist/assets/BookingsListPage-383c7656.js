import{c as b,u as S,a as L,b as P,r as d,j as e,m as x,e as T,B as w,M as O}from"./index-c6f04137.js";import{C as m,a as h,b as g,d as u,c as p,e as E}from"./card-4b24962a.js";import{A as I,a as M,b as F,c as z,d as V,e as Y,f as J,g as U,h as G}from"./alert-dialog-4d4a2cc4.js";import{C as k}from"./calendar-days-1d227aa6.js";import{U as B,D as H}from"./users-4ae25648.js";const R=b("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),X=b("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),W=()=>{const{user:n,loading:l}=S(),c=L(),{toast:a}=P(),[o,C]=d.useState([]),[j,f]=d.useState(!0),y=()=>{if(n){f(!0);try{const t=(JSON.parse(localStorage.getItem("userBookings"))||[]).filter(r=>r.userId===n.id);t.sort((r,i)=>new Date(i.bookingDate)-new Date(r.bookingDate)),C(t),t.length>0}catch(s){console.error("Failed to fetch bookings:",s),a({variant:"destructive",title:"Error",description:"Could not load your bookings."})}finally{f(!1)}}};d.useEffect(()=>{if(!l){if(!n){a({variant:"destructive",title:"Access Denied",description:"Please log in to view your bookings."}),c("/login");return}y()}},[n,l,c,a]);const A=s=>{try{const r=(JSON.parse(localStorage.getItem("userBookings"))||[]).map(i=>i.id===s?{...i,status:"cancelled",cancellationDate:new Date().toISOString()}:i);localStorage.setItem("userBookings",JSON.stringify(r)),y(),a({title:"Booking Cancelled",description:"Your booking has been successfully cancelled."})}catch(t){console.error("Failed to cancel booking:",t),a({variant:"destructive",title:"Error",description:"Could not cancel the booking."})}},N=s=>{switch(s){case"confirmed":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold text-green-800 bg-green-200 rounded-full",children:"Confirmed"});case"cancelled":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold text-red-800 bg-red-200 rounded-full",children:"Cancelled"});default:return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold text-gray-800 bg-gray-200 rounded-full",children:"Unknown"})}};if(j||l)return e.jsx("div",{className:"flex justify-center items-center h-[calc(100vh-10rem)]",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-t-4 border-b-4 border-primary"})});const v=o.filter(s=>s.status==="confirmed"),D=o.filter(s=>s.status==="cancelled");return e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"mx-auto h-16 w-16 text-primary mb-4"}),e.jsx("h1",{className:"text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent",children:"My Bookings"}),e.jsx("p",{className:"text-lg text-muted-foreground mt-2",children:"Review your upcoming and past adventures."})]}),o.length===0?e.jsxs(m,{className:"text-center py-12 glassmorphic",children:[e.jsxs(h,{children:[e.jsx(R,{className:"mx-auto h-12 w-12 text-yellow-500 mb-4"}),e.jsx(g,{className:"text-2xl",children:"No Bookings Yet"})]}),e.jsxs(u,{children:[e.jsx(p,{className:"text-lg",children:"You haven't booked any trips yet. Start exploring and plan your next getaway!"}),e.jsx(w,{onClick:()=>c("/places"),className:"mt-6 bg-gradient-to-r from-primary to-accent hover:opacity-90",children:"Explore Places"})]})]}):e.jsxs(e.Fragment,{children:[v.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-primary",children:"Active Bookings"}),e.jsx("div",{className:"space-y-6",children:v.map((s,t)=>e.jsx(x.div,{initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{duration:.5,delay:t*.1},children:e.jsxs(m,{className:"shadow-lg hover:shadow-xl transition-shadow duration-300 glassmorphic",children:[e.jsxs(h,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(g,{className:"text-2xl text-primary",children:s.placeName}),N(s.status)]}),e.jsxs(p,{children:["Booked on: ",new Date(s.bookingDate).toLocaleDateString()]})]}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"w-5 h-5 mr-2 text-accent"}),e.jsxs("span",{children:["Date of Visit: ",new Date(s.dateOfVisit).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"w-5 h-5 mr-2 text-accent"}),e.jsxs("span",{children:["Guests: ",s.numberOfPeople]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"w-5 h-5 mr-2 text-accent"}),e.jsxs("span",{children:["Total Price: $",s.totalPrice]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"w-5 h-5 mr-2 text-accent"}),e.jsxs("span",{children:["Payment: ",s.paymentMethod.replace(/([A-Z])/g," $1").trim()]})]})]}),e.jsx(E,{children:e.jsxs(I,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(w,{variant:"destructive",size:"sm",children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," Cancel Booking"]})}),e.jsxs(F,{children:[e.jsxs(z,{children:[e.jsx(V,{children:"Are you sure?"}),e.jsxs(Y,{children:["This action cannot be undone. This will permanently cancel your booking for ",s.placeName,"."]})]}),e.jsxs(J,{children:[e.jsx(U,{children:"Keep Booking"}),e.jsx(G,{onClick:()=>A(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Yes, Cancel Booking"})]})]})]})})]})},s.id))})]}),D.length>0&&e.jsxs("section",{className:"mt-12",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-muted-foreground",children:"Cancelled Bookings"}),e.jsx("div",{className:"space-y-6",children:D.map((s,t)=>e.jsx(x.div,{initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{duration:.5,delay:t*.1},children:e.jsxs(m,{className:"shadow-lg glassmorphic opacity-70",children:[e.jsxs(h,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(g,{className:"text-2xl text-muted-foreground line-through",children:s.placeName}),N(s.status)]}),e.jsxs(p,{children:["Cancelled on: ",s.cancellationDate?new Date(s.cancellationDate).toLocaleDateString():"N/A"," (Booked: ",new Date(s.bookingDate).toLocaleDateString(),")"]})]}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"w-5 h-5 mr-2"}),e.jsxs("span",{children:["Date of Visit: ",new Date(s.dateOfVisit).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"w-5 h-5 mr-2"}),e.jsxs("span",{children:["Guests: ",s.numberOfPeople]})]})]})]})},s.id))})]})]})]})};export{W as default};
